#!/usr/bin/env node
const program = require('commander');
// const lolcatjs = require('lolcatjs'); // ä½ç‰ˆæœ¬ ä¸å˜è‰²
const Printer = require('@darkobits/lolcatjs').default; // è‡ªåŠ¨å˜è‰²
const chalk = require('chalk'); // æ”¹å˜æ‰“å°æ–‡å­—çš„é¢œè‰² å½“ç„¶ä¹Ÿå¯ä»¥ç”¨ä¸Šé¢éšæœºé¢œè‰²æ¥å¼„
const inquirer = require('Inquirer'); // è·Ÿç”¨æˆ·äº¤äº’
const json2ts = require('json2ts'); // json è½¬ ts
const shelljs = require('shelljs');
const userhome = require('user-home');
const ora = require('ora'); // loading

var versionIcon = [
    ' ',
    'æ¨å¸…çš„è„šæ‰‹æ¶',
    ' ',
    '__       ___ ',
    '| | | | / __|',
    '| |_| | \__ \\',
    ' \__,  ||___/',
    '  __/ |  ',
    ' |___/ ',
    ' ',
    ' ',
    ' '
].join('\n');   
                                
program
    .version(Printer.fromString(versionIcon), '-v,--version')

// å‘½ä»¤è¡Œå‚æ•°
const bindHandler = {
    init(param) {
        console.log('ç”¨æˆ·å‡†å¤‡åˆå§‹åŒ–é¡¹ç›®, å‚æ•°ä¸º' + param);
        inquirer
        .prompt([
            {
                type: 'text',
                meaaage: '1ï¸âƒ£ è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°',
                name: 'dirname'
            }
        ])
        .then(answers => {
            // ç”¨æˆ·å›ç­”
            console.log(answers.dirname);
            shelljs.cd(`${userhome}/ys/æ„å»ºå·¥å…·/ys-cli/`);
            const spinner = ora('ğŸ‘§ loading...');
            spinner.start();

            shelljs.mkdir(answers.dirname);

            spinner.stop();
        });
    },
    json2ts() {
        const data = {
            name: 'æ¨å¸…',
            data: {
                age: 18
            }
        }

        const jsonContent = JSON.stringify(data);
        let result = json2ts.convert(jsonContent);

        console.log(result);
    }
}

// å®šä¹‰æ–¹æ³• æ¥å—å‘½ä»¤å’Œä¸€ä¸ªå‚æ•° ä¾‹å¦‚ ys init xxx (åˆ‡è®°ä¸åŒ¹é…ys init --xx)
program
    .usage('<cmd> [options]')
    .arguments("<cmd> [env]")
    .action((cmd, otherParmas) => {
        console.log(`å‚æ•°1ï¼š${cmd}`, `å‚æ•°2: ${otherParmas}`);
        const handler = bindHandler[cmd];

        if (typeof handler == 'undefined') {
            console.error(chalk.yellow(`éå¸¸é—æ†¾, ã€${cmd}ã€‘æš‚æœªæä¾›ğŸ¤¥`));
            process.exit(1); // é”™è¯¯é€€å‡º
        } else {
            handler(otherParmas);
        }
    });

program.option('-i,--init', 'è®¾ç½®é¡¹ç›®åˆå§‹åŒ–ğŸ, æ–°å»ºæ–‡ä»¶å¤¹'); // æŠŠ -initæ˜¾ç¤ºåœ¨ ys --helpä¸Š
program.option('-json2ts', 'revert json to ts'); 

program.parse(process.argv);
 